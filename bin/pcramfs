#! /usr/bin/perl

# patch new name into cramfs

$file = shift;
$fs = shift;

if(length($file) > 15 || length($file) < 1) {
  die "invalid file name \"$file\"\n"
}

$file .= "\x00" x (16 - length($file));

open F, "+<$fs";

sysread F, $buf, 64;

seek F, 0, SEEK_SET;

die "oops, is not cramfs\n" unless length($buf) == 64 && substr($buf, 16, 16) eq "Compressed ROMFS" ;

substr($buf, 48, 16) = $file;

syswrite F, $buf;

close F;

