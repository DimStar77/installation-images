#! /usr/bin/perl

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# the usual fuss...

BEGIN { unshift @INC, ( $0 =~ /(.*?)((?<![^\/])bin\/)?[^\/]+$/ )[0] . "lib" }
use ReadConfig;

die "usage: $Script\n" if @ARGV;

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# some config data

$dst = "${DataPath}base/gen/splash";

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# now we really start...

$debug = exists($ENV{'debug'}) ?  $ENV{'debug'} : "";

if($ENV{themes}) {
  @themes{split ' ', $ENV{themes}} = ();
}

for (keys %{$ConfigData{ini}}) {
  next unless /^Theme (.+)$/;
  next unless $ConfigData{ini}{$_}{splash};

  $st{$ConfigData{ini}{$_}{splash}} = 1 if !%themes || exists $themes{$1};
}

mkdir "${DataPath}base/gen", 0755;

open W, ">$dst";

for (sort keys %st) {
  print W
    "bootsplash-theme-$_:\n" .
    "  /\n" .
    "  d /$_\n" .
    "  m /usr/share/splash/themes/$_/bootloader/message /$_/bootlogo\n";

  for $res (qw ( 800x600 1024x768 1280x1024 )) {
    $res2 = sprintf "%04u%04u", split(/x/, $res);
    print W "  E splash -s -f /usr/share/splash/themes/$_/config/bootsplash-${res}.cfg >/$_/${res2}.spl\n"
  }
  print W "\n";
}

close W;

